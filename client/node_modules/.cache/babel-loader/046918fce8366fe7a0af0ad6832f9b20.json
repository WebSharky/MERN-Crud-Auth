{"ast":null,"code":"import { createSlice, nanoid, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport postsService from \"./postsService\";\nconst initialState = {\n  posts: [],\n  userPosts: [],\n  status: 'idle',\n  error: null,\n  createPostStatus: 'idle'\n};\nexport const fetchPosts = createAsyncThunk('posts/fetchPosts', async (_, thunkAPI) => {\n  try {\n    return await postsService.getAllPosts();\n  } catch (error) {\n    const message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n    return thunkAPI.rejectWithValue(message);\n  }\n});\nexport const addNewPost = createAsyncThunk('posts/addNewPost', async (postData, thunkAPI) => {\n  try {\n    const token = thunkAPI.getState().users.user.token;\n    return await postsService.createPost(postData, token);\n  } catch (error) {\n    const message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n    return thunkAPI.rejectWithValue(message);\n  }\n});\nexport const getPostsByUser = createAsyncThunk('posts/fetchPostsByUser', async (req, res, thunkAPI) => {\n  const {\n    nickname\n  } = req.params;\n\n  try {\n    return await postsService.getPostsByUser(nickname);\n  } catch (error) {\n    const message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n    return thunkAPI.rejectWithValue(message);\n  }\n});\nconst postsSlice = createSlice({\n  name: 'posts',\n  initialState,\n  reducers: {\n    postAdded: {\n      reducer(state, action) {\n        console.log(action.payload);\n        state.posts.concat([action.payload]);\n      },\n\n      prepare(title, text, image, author) {\n        return {\n          payload: {\n            _id: nanoid(),\n            title,\n            text,\n            author,\n            image,\n            createdAt: new Date().toISOString()\n          }\n        };\n      }\n\n    }\n  },\n\n  extraReducers(builder) {\n    builder //fetchPosts\n    .addCase(fetchPosts.pending, (state, action) => {\n      state.status = 'loading';\n    }).addCase(fetchPosts.fulfilled, (state, action) => {\n      state.status = 'succeeded';\n      const loadedPosts = action.payload.map(post => {\n        post.myMessage = `to moja wiadomość z ${new Date()}`;\n        return post;\n      });\n      state.posts = state.posts.concat(loadedPosts);\n    }).addCase(fetchPosts.rejected, (state, action) => {\n      state.status = 'failed';\n      state.error = action.error.message;\n    }) //addNewPost\n    .addCase(addNewPost.pending, (state, action) => {\n      state.createPostStatus = 'loading';\n    }).addCase(addNewPost.fulfilled, (state, action) => {\n      state.createPostStatus = 'succeed';\n      state.posts.push(action.payload);\n    }).addCase(addNewPost.rejected, (state, action) => {\n      state.createPostStatus = 'failed';\n      state.error = action.error.message;\n    }) //fetchPostsByUser\n    .addCase(fetchPostsByUser.pending, (state, action) => {\n      state.status = 'loading';\n    }).addCase(fetchPostsByUser.fulfilled, (state, action) => {\n      state.status = 'succeeded';\n      const loadedPosts = action.payload.map(post => {\n        post.myMessage = `to moja wiadomość z ${new Date()}`;\n        return post;\n      });\n      state.posts = state.posts.concat(loadedPosts);\n    }).addCase(fetchPostsByUser.rejected, (state, action) => {\n      state.status = 'failed';\n      state.error = action.error.message;\n    });\n  }\n\n});\nexport const selectAllPosts = state => state.posts.posts;\nexport const selectAllPostsOfUser = state => state.posts.userPosts;\nexport const getPostsStatus = state => state.posts.status;\nexport const getPostsError = state => state.posts.error;\nexport const {\n  postAdded\n} = postsSlice.actions;\nexport default postsSlice.reducer;","map":{"version":3,"names":["createSlice","nanoid","createAsyncThunk","postsService","initialState","posts","userPosts","status","error","createPostStatus","fetchPosts","_","thunkAPI","getAllPosts","message","response","data","toString","rejectWithValue","addNewPost","postData","token","getState","users","user","createPost","getPostsByUser","req","res","nickname","params","postsSlice","name","reducers","postAdded","reducer","state","action","console","log","payload","concat","prepare","title","text","image","author","_id","createdAt","Date","toISOString","extraReducers","builder","addCase","pending","fulfilled","loadedPosts","map","post","myMessage","rejected","push","fetchPostsByUser","selectAllPosts","selectAllPostsOfUser","getPostsStatus","getPostsError","actions"],"sources":["F:/PROJEKTY WWW/MERN_15/client/src/features/posts/postsSlice.js"],"sourcesContent":["import { createSlice, nanoid, createAsyncThunk} from \"@reduxjs/toolkit\";\r\nimport postsService from \"./postsService\";\r\n\r\n\r\nconst initialState = {\r\n   posts: [],\r\n   userPosts: [],\r\n   status: 'idle',\r\n   error: null,\r\n   createPostStatus: 'idle'\r\n}\r\n\r\nexport const fetchPosts = createAsyncThunk(\r\n    'posts/fetchPosts', \r\n    async (_, thunkAPI) => {\r\n    try {\r\n        return await postsService.getAllPosts()\r\n    } catch (error) {\r\n        const message =\r\n          (error.response &&\r\n            error.response.data &&\r\n            error.response.data.message) ||\r\n          error.message ||\r\n          error.toString()\r\n        return thunkAPI.rejectWithValue(message)\r\n      }\r\n})\r\n\r\n\r\nexport const addNewPost = createAsyncThunk(\r\n    'posts/addNewPost',\r\n    async (postData, thunkAPI) => { \r\n      try {\r\n        const token = thunkAPI.getState().users.user.token\r\n        return await postsService.createPost(postData, token)\r\n      } catch (error) {\r\n        const message =\r\n          (error.response &&\r\n            error.response.data &&\r\n            error.response.data.message) ||\r\n          error.message ||\r\n          error.toString()\r\n        return thunkAPI.rejectWithValue(message)\r\n      }\r\n    }\r\n  )\r\n\r\n  export const getPostsByUser = createAsyncThunk(\r\n    'posts/fetchPostsByUser',\r\n    async (req, res, thunkAPI) => { \r\n        const { nickname } = req.params \r\n      try {\r\n        return await postsService.getPostsByUser(nickname)\r\n      } catch (error) {\r\n        const message =\r\n          (error.response &&\r\n            error.response.data &&\r\n            error.response.data.message) ||\r\n          error.message ||\r\n          error.toString()\r\n        return thunkAPI.rejectWithValue(message)\r\n      }\r\n    }\r\n  )\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst postsSlice = createSlice({\r\n    name: 'posts',\r\n    initialState,\r\n    reducers: {\r\n        postAdded: {\r\n            reducer(state, action) {\r\n                console.log(action.payload)\r\n                state.posts.concat([action.payload])\r\n                },\r\n            prepare(title, text, image, author) {\r\n                return {\r\n                    payload: {\r\n                    _id: nanoid(),\r\n                    title,\r\n                    text,\r\n                    author,\r\n                    image,\r\n                    createdAt: new Date().toISOString()               \r\n                }\r\n                }\r\n            }\r\n        },\r\n    },\r\n    extraReducers(builder) {\r\n        builder\r\n            //fetchPosts\r\n            .addCase(fetchPosts.pending, (state, action) => {\r\n                state.status = 'loading'\r\n            })\r\n            .addCase(fetchPosts.fulfilled, (state, action) => {\r\n                state.status = 'succeeded'\r\n                \r\n                const loadedPosts = action.payload.map(post => {\r\n                    post.myMessage = `to moja wiadomość z ${new Date()}`\r\n                    return post\r\n                })\r\n                state.posts = state.posts.concat(loadedPosts)\r\n            })\r\n            .addCase(fetchPosts.rejected, (state, action) => {\r\n                state.status = 'failed'\r\n                state.error = action.error.message\r\n            })\r\n            //addNewPost\r\n            .addCase(addNewPost.pending, (state, action) => {\r\n                state.createPostStatus = 'loading'\r\n                \r\n            })\r\n            .addCase(addNewPost.fulfilled, (state, action) => {\r\n                state.createPostStatus = 'succeed'\r\n                \r\n               \r\n                    state.posts.push(action.payload)\r\n            })\r\n            .addCase(addNewPost.rejected, (state, action) => {\r\n                state.createPostStatus = 'failed'\r\n                state.error = action.error.message\r\n            })\r\n            //fetchPostsByUser\r\n            .addCase(fetchPostsByUser.pending, (state, action) => {\r\n                state.status = 'loading'\r\n            })\r\n            .addCase(fetchPostsByUser.fulfilled, (state, action) => {\r\n                state.status = 'succeeded'\r\n                \r\n                const loadedPosts = action.payload.map(post => {\r\n                    post.myMessage = `to moja wiadomość z ${new Date()}`\r\n                    return post\r\n                })\r\n                state.posts = state.posts.concat(loadedPosts)\r\n            })\r\n            .addCase(fetchPostsByUser.rejected, (state, action) => {\r\n                state.status = 'failed'\r\n                state.error = action.error.message\r\n            })\r\n\r\n\r\n\r\n\r\n\r\n\r\n    }\r\n})\r\n\r\nexport const selectAllPosts = (state) => state.posts.posts\r\nexport const selectAllPostsOfUser = (state) => state.posts.userPosts\r\nexport const getPostsStatus = (state) => state.posts.status\r\nexport const getPostsError = (state) => state.posts.error\r\n\r\nexport const {postAdded} = postsSlice.actions\r\n\r\nexport default postsSlice.reducer"],"mappings":"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"},"metadata":{},"sourceType":"module"}